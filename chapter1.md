# 如何编辑抓取模板

最简单的模板只需填写如下三项即可：![](/assets/model_edit1.png)

1. **模板名称**：给你的模板起一个易于辨识的名字；
2. **网站域名**：填写所要抓取的网站的域名，请注意不要包含http或者https等前缀内容，参见图片；
3. **起始页面**：给定爬虫从哪个页面或者哪些页面开始爬取，可以填写多个地址，请遵循JSON格式填写，参见图片。

在填写上面三项内容以后，一个最简单的爬虫模板就配置成功了，此时可以点击**抓取样例数据**来抓取小部分样例数据，检验模板是否配置正确，能否抓取到想要抓取的数据，如果确定模板配置无误可以**保存此模板**方便今后使用或者**提交抓取任务**来正式开启爬虫的抓取工作。

一般情况下我们是需要对模板进行高级的定制来抓取更为准确的数据，只需点击**显示高级设置**，可以进行更为详细的模板配置。

### 内容高级设置

![](/assets/contentSetting.png)

内容高级设置主要针对页面的抓取内容进行配置：

1. **线程数**：指定该任务抓取时可以开启多少个线程同时抓取网页，建议不要超过10；
2. **最大抓取网页数**：指定该任务最多抓取多少个页面，依据任务需求填写；
3. **重试次数**：指定当有页面抓取失败时重新尝试抓取该页面次数；
4. **睡眠时间**：抓取各个页面之间的间隔等待时间；
5. **超时时间**：依据网络环境或者可访问情况而定，超过设定时间无响应之后则放弃该网页的抓取；
6. **网页编码**：一般不用指定，可以自动探测；
7. **地址正则**：如果想要抓取指定地址类型的网页，可以通过正则表达式填写地址正则，之后在抓取时会通过该正则匹配网页地址，匹配成功才会抓取该网页内容，否则不抓取该网页，该项内容较为重要，可以很好的限定需要抓取的网页；
8. **标题正则**：通过正则表达式匹配网页中的标题内容，比如匹配特定的文字作为标题；
9. **标题XPath**：通过XPath指定网页中标题元素的位置；
10. **正文正则**、**正文XPath**、**分类正则**、**分类XPath**、**发布时间正则**和**发布时间XPath**：指定内容与上面8.9点类似；
11. **发布时间格式**：当抓取到符合要求的发布时间字段时可以通过该处定义的格式进行转换成自己想要的时间格式；
12. **默认分类**、**语言**、**国家**和**回调地址**可暂时不填写，可以自动处理；
13. **添加动态字段**：除去以上已经定义的待抓取内容之外，可以自定义待抓取内容，比如想要抓取文章作者名，则可以点击添加动态字段“author”，同样通过正则表达式来限定内容及XPath来限定抓取位置，“是否网页必须有author”请谨慎勾选，如果勾选了该项，而网页上又没有该项内容，则有可能产生无限抓取的情况，如果出现了意外情况，请在任务中心停止该抓取任务，点击“删除动态字段author”可删除该字段的抓取；![](/assets/dynamicField.png)

14.**添加静态字段**：暂时留作扩展使用。

### 文件抓取设置

![](/assets/fileField.png)**文件抓取设置**主要针对网页中文件的抓取进行设置：

如果想要抓取网页中的图片或者附件，可以点击**添加抓取文件字段**，输入想要抓取的文件的后缀名（大小写需要匹配），如果不填写正则和XPath内容则会默认抓取后缀名形式的文件，如果想要限定抓取的具体文件位置或者文件内容，可以指定正则和XPath，正则匹配文件url，XPath匹配文件位置。

### 爬虫代理设置

![](/assets/proxyField.png)

一般情况下不需要配置该内容，如果想要抓取的网站需要代理才能抓取和访问，则需要配置该内容，此部分暂时处于测试状态，之后会进行完善（包括反爬取机制及IP池等功能模块）。

### 可选设置项

![](/assets/otherSettings.png)

1. **自然语言处理（包括摘要、关键词、命名实体抽取）**：爬虫在处理网页文字内容时可进行自然语言处理，提取摘要和关键词等相关信息，默认勾选；
2. **保存网页快照**：保存已经抓取的网页内容，方便检索及二次抓取，默认勾选；
3. **只抓取首页**：勾选该项则不会探测更深一级的网页内容，只会抓取当前页面内容；
4. **网页必须有标题**、**网页必须有正文**、**网页必须有发布时间**：对抓取的网页内容的限定，请谨慎勾选，防止造成无限抓取；
5. **自动探测发布时间**：爬虫内配置了默认的发布时间探测规则，但是默认探测范围较广，较为费时，如果想要提高抓取效率请自行在内容高级设置中配置发布时间探测规则，默认关闭；
6. **是ajax页面**：此选项针对使用ajax渲染的页面，目前处于扩展完善阶段，暂不勾选；
7. **使用Selenium渲染页面**：此选项为针对动态页面的设置，比如页面上某个元素需要点击后才会出现，当需要抓取此类页面时请勾选此项，勾选后会出现点击加载流设置，配置见下文内容。

### 点击加载流设置

![](/assets/clickField.png)

当勾选**使用Selenium渲染页面**选项以后会出现该设置内容。

该部分需要根据页面操作逻辑来合理设置，我以爬取国家工商局的商标页图片为例：

![](/assets/sbgg01.png)该页面中各个商标图片的链接原本是不存在，需要先点击**查看**之后才会动态加载商标图片，并且该页面是通过**分页**来切换数据的，我们的操作逻辑是：

1. 点击查看按钮，等待页面加载商标图片如下图；![](/assets/sdgg02.png)
2. 图片链接加载出来之后点击弹出框右上角的关闭按钮关闭该弹出框，然后在页面下方的分页框中输入跳转的页面，查看下一页内容；![](/assets/sdgg03.png)
3. 下一页内容加载完毕后重复上述1.2步骤，一直查看到最后一页。

操作逻辑确定之后，我们就可以按照这个逻辑来配置**点击加载流设置**，所添加的元素命名时名称任意，但不可重名，且为英文和数字形式：

1.添加点击**查看**元素：例如show；

2.添加待加载元素：例如img；

3.填写点击元素和待加载元素的的XPath来指定元素位置，然后填写等待加载的时长（不超过15s）；

（1.2.3步骤对应操作逻辑中的第一步）

4.添加点击关闭元素：例如close；

5.添加待加载元素：这里就直接等待**查看**元素就可以了，也就是给一个关闭弹出框的时间，例如填写show2；

6.填写点击元素和待加载元素的的XPath来指定元素位置，然后填写等待加载的时长（不超过15s）；

（4.5.6步骤对应操作逻辑中的第二步）

7.添加分页元素：例如paging；

8.添加待加载元素：输入页码加载了新的一页之后要等待**查看**元素加载出来，这个页面才算再次加载完成，所以我们这里填写show3；

9.填写点击元素和待加载元素的的XPath来指定元素位置，然后填写等待加载的时长（不超过15s）；

10.针对分页元素paging需要勾选paging为分页元素，然后设定最大抓取分页数，请根据页面实际情况设置，不要超过页面的最大页码数；

（7.8.9.10步骤对应操作逻辑中的第三步）

点击加载流配置结果如下图所示：

![](/assets/clickField02.png)

### 完成

![](/assets/complete02.png)

此时一个较为详细的爬虫模板就配置完成了，我们可以把这个模板**导出为JSON**，然后在下方文本框中拷贝出来自己保存，或者**保存此模板**到服务器上，一般在配置完成后会先**抓取样例数据**，来测试模板配置是否能抓取到自己想要的数据，注意在抓取样例数据时请将抓取量设置的小一些，例如减小内容高级设置中的最大抓取网页数及减少最大分页数，来尽快看到测试结果，如果抓取样例数据量太大，可能超出爬虫内置的最大超时五分钟的时长，无法取得抓取结果，如果出现错误或者想要停止该样例数据的抓取过程，请在任务中心停止该抓取过程，确定模板配置无误之后，再将抓取数量设置为生产环节中的合理数量，然后**提交抓取任务**，爬虫则正式开启抓取任务。

### JSON爬虫模板

![](/assets/JSON.png)

如果我们手里有已经配置好的JSON格式的爬虫模板，可以在**JSON爬虫模板**文本框中直接填入JSON内容，然后点击**回填表格**，即可回填所有配置好的参数，之后可以**保存此模板**或者用此模板进行抓取。

